var DropButton=pc.createScript("dropButton");DropButton.prototype.initialize=function(){this.entity.button.active=!0,this.entity.button.on("touchstart",(function(){this.app.fire("dropButtonPress")}),this),this.entity.button.on("mousedown",(function(){this.app.fire("dropButtonPress")}),this),this.entity.button.on("touchend",(function(){this.app.fire("dropButtonRelease")}),this),this.entity.button.on("mouseup",(function(){this.app.fire("dropButtonRelease")}),this)};var Game=pc.createScript("game");Game.prototype.initialize=function(){this.isGameBeingPlayed=!1,this.score=0,this.maximumLives=6,this.lives=this.maximumLives,this.app.on("dropButtonPress",this.dropButtonPress,this),this.app.on("succesfulDrop",this.succesfulDrop,this),this.app.on("unsuccesfulDrop",this.unsuccesfulDrop,this),this.app.on("resetGameData",this.resetGame,this)},Game.prototype.update=function(s){},Game.prototype.dropButtonPress=function(){this.app.fire("drop")},Game.prototype.succesfulDrop=function(s){this.addToScore(1)},Game.prototype.unsuccesfulDrop=function(s){this.app.fire("loseLifeOnDisplay"),this.lives-=1,0===this.lives&&this.app.fire("stopGame")},Game.prototype.addToScore=function(s){this.score+=s,this.app.fire("addPoints",s),this.app.fire("setScoreDisplay",this.score)},Game.prototype.resetGame=function(){this.score=0,this.app.fire("setScoreDisplay",this.score),this.lives=this.maximumLives,this.app.fire("resetLivesDisplay"),this.app.fire("resetObjectsAndDropper")};var Dropper=pc.createScript("dropper");Dropper.attributes.add("template0",{type:"asset",assetType:"template"}),Dropper.attributes.add("template1",{type:"asset",assetType:"template"}),Dropper.attributes.add("template2",{type:"asset",assetType:"template"}),Dropper.attributes.add("render0",{type:"asset",assetType:"render"}),Dropper.attributes.add("render1",{type:"asset",assetType:"render"}),Dropper.attributes.add("render2",{type:"asset",assetType:"render"}),Dropper.prototype.initialize=function(){this.gameScene=this.app.root.findByTag("game")[0],this.bound1=this.entity.findByTag("bound1")[0],this.bound2=this.entity.findByTag("bound2")[0],this.pin=this.entity.findByTag("pin")[0],this.pinRenderEntity=this.entity.findByTag("pinRenderEntity")[0],this.dropperRoot=this.entity,this.worldInitialDropperPos=this.dropperRoot.getPosition().clone(),this.initialDropperPos=this.dropperRoot.getLocalPosition().clone(),this.firstDrop=!0,this.canDrop=!0,this.isGhosting=!0,this.pinMoveTween=void 0,this.levelTransitionTween=void 0,this.transitionSpeed=.75,this.succesfulObjectArray=[],this.goToHighestObjectTimer=0,this.isHighestObjectTimerActive=!1,this.bottomObject=void 0,this.currentLevel=0,this.levelPerTemplate=3,this.resetMovement(),this.startMovement(),this.createPinObject(),this.app.on("drop",this.drop,this),this.app.on("succesfulDrop",this.startLevelTransition,this),this.app.on("unsuccesfulDrop",this.unsuccesfulDrop,this),this.app.on("resetObjectsAndDropper",this.resetObjectsAndDropper,this),this.entity.on("succesfulSettle",this.onSuccesfulSettle,this),this.entity.on("objectDestroy",this.onObjectDestroy,this),this.entity.on("resetFirstDrop",this.resetFirstDrop,this)},Dropper.prototype.update=function(t){this.isHighestObjectTimerActive&&(this.goToHighestObjectTimer+=t,this.goToHighestObjectTimer>2&&(this.isHighestObjectTimerActive=!1,0===this.succesfulObjectArray.length||this.getHighestObject().findByTag("stackObject")[0].getPosition().y+.5<this.worldInitialDropperPos.y?this.startLevelTransitionWPos(this.initialDropperPos):this.startLevelTransition(this.getHighestObject())))},Dropper.prototype.drop=function(){if(this.canDrop){this.canDrop=!1;let t=this.spawnTemplateAtPin(this.getTemplate(this.currentLevel));this.disablePinObject(),this.currentLevel+=1,this.firstDrop&&(this.firstDrop=!1,t.fire("setCanDie",!1))}},Dropper.prototype.spawnTemplateAtPin=function(t){let e=t.resource.instantiate(),i=e.findByTag("stackObject")[0];return i.rigidbody.teleport(this.pin.getPosition(),pc.Vec3.ZERO),i.rigidbody.linearVelocity=pc.Vec3.ZERO,i.rigidbody.angularVelocity=pc.Vec3.ZERO,this.gameScene.addChild(e),e},Dropper.prototype.startMovement=function(){this.pinTween.start()},Dropper.prototype.endMovement=function(){this.pinTween.stop()},Dropper.prototype.onSuccesfulSettle=function(t){0===this.succesfulObjectArray.length&&(this.bottomObject=t),this.succesfulObjectArray.push(t)},Dropper.prototype.onObjectDestroy=function(t){let e=this.succesfulObjectArray.indexOf(t);-1!==e&&this.succesfulObjectArray.splice(e,1),this.resetAndStartHighestObjectTimer()},Dropper.prototype.getHighestObject=function(){let t,e,i=this.bottomObject;for(let s=0;s<this.succesfulObjectArray.length;s++)t=this.succesfulObjectArray[s].findByTag("stackObject")[0].getPosition().y,e=i.findByTag("stackObject")[0].getPosition().y,t>e&&(i=this.succesfulObjectArray[s]);return i},Dropper.prototype.resetAndStartHighestObjectTimer=function(){this.goToHighestObjectTimer=0,this.isHighestObjectTimerActive=!0},Dropper.prototype.startLevelTransition=function(t){let e=this,i=t.findByTag("stackObject")[0].getPosition();i.y=i.y+1,this.enablePinObject(),this.levelTransitionTween=this.dropperRoot.tween(this.dropperRoot.getLocalPosition()).to(i,this.transitionSpeed,pc.BackOut).onComplete((function(){e.canDrop=!0}),this).onUpdate((function(){e.app.fire("dragCameraPivot",e.dropperRoot.getLocalPosition())}),this).start()},Dropper.prototype.startLevelTransitionWPos=function(t){let e=this,i=t;i.y=i.y+1,this.enablePinObject(),this.levelTransitionTween=this.dropperRoot.tween(this.dropperRoot.getLocalPosition()).to(i,this.transitionSpeed,pc.BackOut).onComplete((function(){e.canDrop=!0}),this).onUpdate((function(){e.app.fire("dragCameraPivot",e.dropperRoot.getLocalPosition())}),this).start()},Dropper.prototype.unsuccesfulDrop=function(t){this.canDrop=!0,this.enablePinObject()},Dropper.prototype.resetMovement=function(){this.pin.setLocalPosition(this.bound1.getLocalPosition()),this.pinTween=this.pin.tween(this.pin.getLocalPosition()).to(this.bound2.getLocalPosition(),1.4,pc.QuadraticInOut).loop(!0).yoyo(!0)},Dropper.prototype.getTemplate=function(t){return t/this.levelPerTemplate<1?this.template0:t/this.levelPerTemplate<2?this.template1:this.template2},Dropper.prototype.getRender=function(t){return t/this.levelPerTemplate<1?this.render0:t/this.levelPerTemplate<2?this.render1:this.render2},Dropper.prototype.createPinObject=function(){this.pinRenderEntity.render.asset=this.render0;this.pinRenderEntity.render.meshInstances[0]},Dropper.prototype.disablePinObject=function(){this.pinRenderEntity.enabled=!1,this.isGhosting=!1},Dropper.prototype.enablePinObject=function(){this.isGhosting||(this.pinRenderEntity.setLocalScale(0,0,0),this.pinRenderEntity.render.asset=this.getRender(this.currentLevel),this.pinRenderEntity.tween(this.pinRenderEntity.getLocalScale()).to(new pc.Vec3(1,1,1),.35,pc.QuadraticInOut).start(),this.pinRenderEntity.enabled=!0,this.isGhosting=!0)},Dropper.prototype.resetObjectsAndDropper=function(){for(let t=0;t<this.succesfulObjectArray.length;t++)this.succesfulObjectArray[t].findByTag("stackObject")[0].fire("removeFromGame");this.succesfulObjectArray=[],this.resetDropper(),this.resetInitialVariables()},Dropper.prototype.resetDropper=function(){null!=this.levelTransitionTween&&this.levelTransitionTween.stop(),this.dropperRoot.setLocalPosition(this.initialDropperPos),this.app.fire("dragCameraPivot",this.dropperRoot.getLocalPosition()),this.createPinObject()},Dropper.prototype.resetFirstDrop=function(){this.firstDrop=!0},Dropper.prototype.resetInitialVariables=function(){this.firstDrop=!0,this.canDrop=!0,this.isGhosting=!0,this.currentLevel=0,this.succesfulObjectArray=[],this.goToHighestObjectTimer=0,this.isHighestObjectTimerActive=!1,this.bottomObject=void 0};var CubeState=pc.createScript("cubeState");CubeState.attributes.add("settledMaterial",{type:"asset",assetType:"material"}),CubeState.attributes.add("timeForSettle",{type:"number",default:.5,min:0,max:2,title:"Timer for Settling",description:"How long an object must sit still until a succesful settled object is registered"}),CubeState.attributes.add("settledColor",{type:"rgb",title:"Settled Color",description:"The color of the physics object after the object has settled"}),CubeState.attributes.add("notSettledColor",{type:"rgb",title:"Not Settled Color",description:"The color of the physics object before the object has settled"}),CubeState.prototype.initialize=function(){this.stackObject=this.entity.findByTag("stackObject")[0],this.dropperParent=this.app.root.findByTag("dropperRoot")[0],this.nextDropPosEntity=this.stackObject.findByTag("nextDropPos")[0],this.mesh=this.stackObject.findByTag("mesh")[0],this.canBeKilled=!0,this.isDying=!1,this.canSettle=!0,this.settleTimer=0,this.hasSettled=!1,this.stackObject.on("kill",this.destroy,this),this.stackObject.on("removeFromGame",this.removeFromGame,this),this.entity.on("setCanDie",this.setCanDie,this)},CubeState.prototype.destroy=function(t){t&!this.isDying&&(this.canBeKilled=!0,this.dropperParent.fire("resetFirstDrop")),!this.isDying&&this.canBeKilled&&(this.dropperParent.fire("objectDestroy",this.entity),this.canSettle=!1,this.isDying=!0,this.app.fire("unsuccesfulDrop",this.entity),this.mesh.tween(this.mesh.getLocalScale()).to(new pc.Vec3(0,0,0),1,pc.QuadraticInOut).onComplete((function(){this.entity.destroy()}),this).start())},CubeState.prototype.removeFromGame=function(){this.entity.destroy()},CubeState.prototype.update=function(t){this.hasSettled||(this.stackObject.rigidbody.linearVelocity.lengthSq()<.01&&this.stackObject.rigidbody.angularVelocity.lengthSq()<.01?(this.settleTimer+=t,this.settleTimer>=this.timeForSettle&&this.onSettled()):this.settleTimer=0)},CubeState.prototype.onSettled=function(){if(this.canSettle&&!this.hasSettled){this.hasSettled=!0;let t=this.entity.findByTag("stackObject")[0].findComponents("render");this.tweenToSettledColor(t[0].meshInstances[0]),this.dropperParent.fire("succesfulSettle",this.entity),this.app.fire("succesfulDrop",this.entity)}},CubeState.prototype.setCanDie=function(t){this.canBeKilled=t},CubeState.prototype.tweenToSettledColor=function(t){let e=this;this.entity.tween(this.notSettledColor).to(this.settledColor,.25,pc.QuadraticInOut).onUpdate((function(){t.setParameter("material_diffuse",[e.notSettledColor.r,e.notSettledColor.g,e.notSettledColor.b])}),this).start()};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("autoRender",{type:"boolean",default:!0,title:"Auto Render",description:"Disable to only render when camera is moving (saves power when the camera is still)"}),OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.prototype.pivotUpdateFocus=function(t){this._buildAabb(t,0),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.initialize=function(){this._checkAspectRatio(),this.shouldBeTrackingDropper=!1,this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this.focusEntity.getPosition());var t=this.entity.getRotation();if(this._yaw=this._calcYaw(t),this._pitch=this._clampPitchAngle(this._calcPitch(t,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var i=new pc.Vec3;i.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(i.length())}this._targetDistance=this._distance,this._autoRenderDefault=this.app.autoRender,this.app.autoRender&&(this.app.autoRender=this.autoRender),this.autoRender||(this.app.renderNextFrame=!0),this.isPitchedDown=!1,this.on("attr:autoRender",(function(t,i){this.app.autoRender=t,this.autoRender||(this.app.renderNextFrame=!0)}),this),this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this);var onResizeCanvas=function(){this._checkAspectRatio(),this.autoRender||(this.app.renderNextFrame=!0)};this.app.graphicsDevice.on("resizecanvas",onResizeCanvas,this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",onResizeCanvas,this),this.app.autoRender=this._autoRenderDefault}),this),this.app.on("dragCameraPivot",(function(t){this._pivotPoint.copy(t)}),this)},OrbitCamera.prototype.update=function(t){if(!this.autoRender){var i=Math.abs(this._targetDistance-this._distance),e=Math.abs(this._targetYaw-this._yaw),a=Math.abs(this._targetPitch-this._pitch);this.app.renderNextFrame=this.app.renderNextFrame||i>.01||e>.01||a>.01}var s=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,s),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,s),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,s),this.isPitchedDown?this._pitch>-50&&(this.isPitchedDown=!1,this.app.fire("cameraPitchChange",this.isPitchedDown)):this._pitch<=-50&&(this.isPitchedDown=!0,this.app.fire("cameraPitchChange",this.isPitchedDown)),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e,a=0,s=0;if(t instanceof pc.Entity){var n=[],r=t.findComponents("render");for(a=0;a<r.length;++a)if(e=r[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);var h=t.findComponents("model");for(a=0;a<h.length;++a)if(e=h[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);for(a=0;a<n.length;a++)0===i?this._modelsAabb.copy(n[a].aabb):this._modelsAabb.add(n[a].aabb),i+=1}for(a=0;a<t.children.length;++a)i+=this._buildAabb(t.children[a],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.isGameplayEnabled=!1,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2,this.app.on("enableGameplay",this.enableGameControls,this),this.app.on("disableGameplay",this.disableGameControls,this)},MouseInput.prototype.enableGameControls=function(){this.isGameplayEnabled=!0},MouseInput.prototype.disableGameControls=function(){this.isGameplayEnabled=!1},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,s=MouseInput.worldDiff,i=this.entity.camera,n=this.orbitCamera.distance;i.screenToWorld(t.x,t.y,n,o),i.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),s.sub2(e,o),this.orbitCamera.pivotPoint.add(s)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.isGameplayEnabled&&(this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault())},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var GameInput=pc.createScript("gameInput");GameInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),GameInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),GameInput.attributes.add("dropButtonTimerThreshold",{type:"number",default:.2,min:.1,max:1,title:"Drop Button Timer Threshold",description:"How long the button can be held down before a drop will not occur. In seconds"}),GameInput.attributes.add("dropMoveThreshold",{type:"number",default:60,min:30,max:150,title:"Drop Button Distance Moved Threshold",description:"How far can the user move their finger while trying to drop before a drop will not occur"}),GameInput.prototype.initialize=function(){this.dropButtonTimer=0,this.canDropOccur=!0,this.isGameplayEnabled=!1,this.isButtonPressed=!1,this.dropMoveThreshold=60,this.dropMoveCounter=0,this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.app.touch?(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)}))):(this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this)}))),this.app.on("enableGameplay",this.enableGameControls,this),this.app.on("disableGameplay",this.disableGameControls,this)},GameInput.prototype.enableGameControls=function(){this.isGameplayEnabled=!0},GameInput.prototype.disableGameControls=function(){this.isGameplayEnabled=!1},GameInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,e=t.y-i.y;return Math.sqrt(o*o+e*e)},GameInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},GameInput.prototype.onTouchStart=function(t){this.isGameplayEnabled&&(1===t.touches.length&&(this.isButtonPressed=!0),t.touches.length>1&&(this.canDropOccur=!1),this.cameraControlsStartEndCancel(t,!1))},GameInput.prototype.onMouseDown=function(t){this.isGameplayEnabled&&(this.isButtonPressed=!0,this.cameraControlsStartEndCancel(t,!0))},GameInput.prototype.onTouchEndCancel=function(t){this.isGameplayEnabled&&(this.isButtonPressed=!1,this.dropButtonTimer<=this.dropButtonTimerThreshold&&this.dropMoveCounter<=this.dropMoveThreshold&&this.canDropOccur&&this.app.fire("dropButtonPress"),0===t.touches.length&&(this.canDropOccur=!0,this.dropMoveCounter=0,this.dropButtonTimer=0),this.cameraControlsStartEndCancel(t,!1))},GameInput.prototype.onMouseUp=function(t){this.isGameplayEnabled&&(this.isButtonPressed=!1,this.dropButtonTimer<=this.dropButtonTimerThreshold&&this.dropMoveCounter<=this.dropMoveThreshold&&this.canDropOccur&&this.app.fire("dropButtonPress"),this.canDropOccur=!0,this.dropMoveCounter=0,this.dropButtonTimer=0,this.cameraControlsStartEndCancel(t,!0))},GameInput.prototype.cameraControlsStartEndCancel=function(t,i){if(this.isGameplayEnabled)if(i)this.lastTouchPoint.set(t.x,t.y);else{var o=t.touches;1==o.length?this.lastTouchPoint.set(o[0].x,o[0].y):2==o.length&&(this.lastPinchDistance=this.getPinchDistance(o[0],o[1]),this.calcMidPoint(o[0],o[1],this.lastPinchMidPoint))}},GameInput.pinchMidPoint=new pc.Vec2,GameInput.prototype.onTouchMove=function(t){if(this.isGameplayEnabled){var i=GameInput.pinchMidPoint,o=t.touches;if(1==o.length){var e=o[0];this.dropMoveCounter<this.dropMoveThreshold&&(this.dropMoveCounter+=Math.abs(e.x-this.lastTouchPoint.x),this.dropMoveCounter+=Math.abs(e.y-this.lastTouchPoint.y)),this.orbitCamera.pitch-=(e.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(e.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(e.x,e.y)}else if(2==o.length){var s=this.getPinchDistance(o[0],o[1]),n=s-this.lastPinchDistance;this.lastPinchDistance=s,this.orbitCamera.distance-=n*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.lastPinchMidPoint.copy(i)}}},GameInput.prototype.onMouseMove=function(t){this.isGameplayEnabled&&this.isButtonPressed&&(this.dropMoveCounter<this.dropMoveThreshold&&(this.dropMoveCounter+=Math.abs(t.x-this.lastTouchPoint.x),this.dropMoveCounter+=Math.abs(t.y-this.lastTouchPoint.y)),this.orbitCamera.pitch-=(t.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(t.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(t.x,t.y))},GameInput.prototype.update=function(t){this.isButtonPressed&&(this.dropButtonTimer+=t)},GameInput.prototype.onMouseWheel=function(t){this.isGameplayEnabled&&(this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault())};var KillTrigger=pc.createScript("killTrigger");KillTrigger.attributes.add("shouldKillBase",{type:"boolean",default:!0}),KillTrigger.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},KillTrigger.prototype.onTriggerEnter=function(i){i.tags.has("stackObject")&&i.fire("kill",this.shouldKillBase)};var Screen=pc.createScript("screen");Screen.attributes.add("fanSpeed",{type:"number",default:5,min:0,max:100,title:"Fan Rotation Speed",description:"How quickly the blades of the fan will rotate"}),Screen.attributes.add("moveSpeed",{type:"number",default:32,min:2,max:50,title:"Screen Movement Speed",description:"How quickly the screen will approach the correct point. Higher number is slower"}),Screen.attributes.add("heightOffset",{type:"number",default:10,min:-20,max:200,title:"Screen Height Offset",description:"Height Offset from tracking the cube dropper"}),Screen.prototype.initialize=function(){this.fanWings=this.app.root.findByTag("wings")[0],this.dropperRoot=this.app.root.findByTag("dropperRoot")[0],this.xyCameraEntity=this.app.root.findByTag("screenxy")[0],this.rotationalxyCameraEntity=this.app.root.findByTag("screenxyrot")[0],this.trackRotationalEntity=!1,this.tvModel=this.entity.findByTag("tvModel")[0],this.screenLookAtEntity=this.entity.findByTag("screenLookAt")[0],this.floatEntity=this.entity.findByTag("float")[0],this.lookAtPos=new pc.Vec3(0,0,0),this.yEntity=this.entity,this.xyEntity=this.entity.findByTag("xyEntity")[0],this.currentHeightOffset=-13,this.floatTo=new pc.Vec3(0,this.floatEntity.getLocalPosition().clone().y+1,0),this.floatEntity.tween(this.floatEntity.getLocalPosition()).to(this.floatTo,1.4,pc.QuadraticInOut).loop(!0).yoyo(!0).start(),this.app.on("cameraPitchChange",(function(t){this.trackRotationalEntity=t}),this),this.app.on("startGameIntro",this.startScreenIntro,this)},Screen.prototype.update=function(t){this.fanWings.rotate(0,this.fanSpeed*t*5,0),this.lookAtPos=this.screenLookAtEntity.getPosition(),this.tvModel.lookAt(this.lookAtPos.x,this.lookAtPos.y,this.lookAtPos.z),this.approachCorrectPosXY(),this.yEntity.setLocalPosition(0,this.dropperRoot.getPosition().y+this.currentHeightOffset,0)},Screen.prototype.startScreenIntro=function(){let t=this,i={height:this.currentHeightOffset};this.entity.tween(i).to({height:this.heightOffset},1.4,pc.QuadraticOut).onUpdate((function(){t.currentHeightOffset=i.height})).start()},Screen.prototype.approachCorrectPosXY=function(){let t,i,e=this.xyEntity.getLocalPosition().x,o=this.xyEntity.getLocalPosition().z;this.trackRotationalEntity?(t=this.rotationalxyCameraEntity.getPosition().x,i=this.rotationalxyCameraEntity.getPosition().z):(t=this.xyCameraEntity.getPosition().x,i=this.xyCameraEntity.getPosition().z);let n=(t-e)/this.moveSpeed,s=(i-o)/this.moveSpeed;this.xyEntity.setLocalPosition(e+n,0,o+s)};var FollowObject=pc.createScript("followObject");FollowObject.attributes.add("targetEntity",{type:"entity",title:"Follow Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),FollowObject.attributes.add("moveSpeed",{type:"number",default:40,min:2,max:100,title:"Follow Speed",description:"How quickly the screen will approach the correct point. Higher number is slower"}),FollowObject.prototype.initialize=function(){},FollowObject.prototype.update=function(t){this.approachCorrectPos()},FollowObject.prototype.approachCorrectPos=function(){let t=this.entity.getPosition().x,e=this.entity.getPosition().y,o=this.entity.getPosition().z,i=this.targetEntity.getPosition().x,n=this.targetEntity.getPosition().y,l=this.targetEntity.getPosition().z;i=(i-t)/this.moveSpeed,n=(n-e)/this.moveSpeed,l=(l-o)/this.moveSpeed,this.entity.setPosition(t+i,e+n,o+l)};var ScreenDisplay=pc.createScript("screenDisplay");ScreenDisplay.attributes.add("scanLineSpeed",{type:"number",default:0,min:0,max:.5,title:"Scan Line Speed",description:"How quickly the scan lines will pan across the screens display"}),ScreenDisplay.attributes.add("loseLifeFadeSpeed",{type:"number",default:.3,min:0,max:1,title:"Lose Life Fade Speed",description:"How quickly a life will fade away when losing a life"}),ScreenDisplay.attributes.add("lostLifeOpacity",{type:"number",default:.3,min:0,max:1,title:"Lost Life Image Opacity",description:"Opacity of a life that has been taken"}),ScreenDisplay.prototype.initialize=function(){this.scoreText0=this.entity.findByTag("scoreText0")[0],this.scoreText1=this.entity.findByTag("scoreText1")[0],this.lives=this.entity.findByTag("lifeParent")[0],this.bgMat=this.entity.findByTag("screenBg")[0].findComponents("render")[0].meshInstances[0].material,this.panMatVec=new pc.Vec2(0,0),this.lifeIterator=0,this.app.on("setScoreDisplay",this.setScoreText,this),this.app.on("loseLifeOnDisplay",this.loseLife,this),this.app.on("resetLivesDisplay",this.resetLives,this)},ScreenDisplay.prototype.update=function(e){this.panMatVec.y+=this.scanLineSpeed*e,this.bgMat.emissiveMapOffset.set(this.panMatVec.x,this.panMatVec.y),this.bgMat.update()},ScreenDisplay.prototype.setScoreText=function(e){let t=e;t=e<10?"0"+e.toString():e.toString(),this.scoreText0.element.text=t[0],this.scoreText1.element.text=t[1]},ScreenDisplay.prototype.loseLife=function(){let e=this.lives.children[this.lifeIterator];if(null!=e){let t={value:1};e.tween(t).to({value:this.lostLifeOpacity},this.loseLifeFadeSpeed,pc.QuadraticInOut).onUpdate((function(){e.element.opacity=t.value})).start()}this.lifeIterator++},ScreenDisplay.prototype.resetLives=function(){this.lifeIterator=0;for(let e=0;e<this.lives.children.length;e++)this.lives.children[e].element.opacity=1};var Water=pc.createScript("water");Water.attributes.add("vs",{type:"asset",assetType:"shader",title:"Vertex Shader"}),Water.attributes.add("fs",{type:"asset",assetType:"shader",title:"Fragment Shader"}),Water.attributes.add("surfaceTexture",{type:"asset",assetType:"texture",title:"Surface Texture"}),Water.attributes.add("isMask",{type:"boolean",title:"Is Mask?"}),Water.prototype.CreateWaterMaterial=function(){var e=new pc.Material;e.name="DynamicWater_Material";var t=this.app.graphicsDevice,a="precision "+t.precision+" float;\n";a+=this.fs.resource;var r=this.vs.resource,s={attributes:{aPosition:pc.gfx.SEMANTIC_POSITION,aUv0:pc.SEMANTIC_TEXCOORD0},vshader:r,fshader:a};this.shader=new pc.Shader(t,s),e.blendType=pc.BLEND_NORMAL,this.camera||(this.camera=this.app.root.findByName("Camera").camera);var i=this.camera,h=i.nearClip,c=i.farClip,p=[1/c,c,(1-c/h)/2,(1+c/h)/2];return e.setParameter("camera_params",p),e.setParameter("uTime",this.time),e.setParameter("uSurfaceTexture",this.surfaceTexture.resource),e.setParameter("isMask",this.isMask),this.material=e,e.setShader(this.shader),e},Water.prototype.initialize=function(){this.time=0,this.material=this.CreateWaterMaterial(),this.entity.render.meshInstances[0].material=this.material,this.savedVS=this.vs.resource,this.savedFS=this.fs.resource},Water.prototype.update=function(e){if(this.savedFS!=this.fs.resource||this.savedVS!=this.vs.resource){var t=this.CreateWaterMaterial();this.entity.render.meshInstances[0].material=t,this.savedVS=this.vs.resource,this.savedFS=this.fs.resource}this.time+=e,this.material.setParameter("uTime",this.time)},Water.prototype.swap=function(e){this.time=e.time};var Flag=pc.createScript("flag");Flag.attributes.add("flagMat1",{type:"asset",assetType:"material"}),Flag.attributes.add("flagMat2",{type:"asset",assetType:"material"}),Flag.attributes.add("oneWaveTime",{type:"number",default:1,min:.5,max:3,title:"Time for wave",description:"Time for one wave of the flag"}),Flag.attributes.add("maxWaveTimeDelta",{type:"number",default:.25,min:0,max:.4,title:"Max Wave Time +- Delta",description:"Max Time added or subtracted from the base time"}),Flag.attributes.add("zRot1",{type:"number",default:45,min:0,max:80,title:"Initial Z Rotation",description:"Starting point for the flags rotation"}),Flag.attributes.add("zRot2",{type:"number",default:45,min:0,max:80,title:"Ending Z Rotation",description:"Ending point for the flags rotation"}),Flag.attributes.add("shakeSpeed",{type:"number",default:3,min:0,max:10,title:"Shake Speed",description:"How fast to shake flags"}),Flag.prototype.initialize=function(){this.entity.setLocalEulerAngles(0,0,-this.zRot1),this.waveTime=this.getWaveTime(),this.randomizeMat(),this.flagTween=this.entity.tween(this.entity.getLocalEulerAngles()).rotate(new pc.Vec3(0,0,this.zRot2),this.waveTime,pc.QuadraticInOut).loop(!0).yoyo(!0).start(),this.app.on("shakeFlags",this.shakeFlag,this)},Flag.prototype.update=function(t){},Flag.prototype.getWaveTime=function(t){let e=Math.random()*this.maxWaveTimeDelta;return Math.random()<.5&&(e*=-1),e+=this.oneWaveTime,e},Flag.prototype.randomizeMat=function(){let t=this.entity.findByTag("flag")[0].findComponents("render")[0].meshInstances[0],e=Math.random();e<.33?t.material=this.flagMat1.resource:e<.66&&(t.material=this.flagMat2.resource)},Flag.prototype.shakeFlag=function(){};var Crowd=pc.createScript("crowd");Crowd.prototype.initialize=function(){Math.random()<.5&&(this.entity.sprite.flipX=!0),Math.random()<.5&&(this.entity.sprite.flipY=!0);let t=Math.random()/4;Math.random()<.5?this.entity.sprite.speed=1+t:this.entity.sprite.speed=1-t},Crowd.prototype.update=function(t){};var InGameUi=pc.createScript("inGameUi");InGameUi.prototype.initialize=function(){this.windValue=0,this.livesValue=void 0,this.windArrow=this.app.root.findByTag("windArrow")[0],this.windSpeed=this.entity.findByTag("windValue")[0],this.scoreValue=this.entity.findByTag("scoreValue")[0],this.lifeParent=this.entity.findByTag("lives")[0],this.arrowTween=void 0,this.app.on("updateInGameUI",this.updateInGameUI,this)},InGameUi.prototype.updateInGameUI=function(t,e){if(this.windValue!=t){let e=90+this.getRandomInt(-25,45);t>0?e=-e:0===t&&(e=180),this.windArrow.tween(this.windArrow.getLocalEulerAngles()).rotate(new pc.Vec3(180,e,180),2,pc.BackOut).onUpdate((function(){}),this).start(),this.windSpeed.element.text=0!=t?Math.abs(t).toString():"0"}if(this.livesValue!=e){let t={value:1},i=this;null!=this.lifeParent.children[e]&&this.entity.tween(t).to({value:0},.3,pc.QuadraticInOut).onUpdate((function(){i.lifeParent.children[e].element.opacity=t.value}),this).start()}this.windValue=t,this.livesValue=e},InGameUi.prototype.getRandomInt=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1)+t)};var UiSceneManager=pc.createScript("uiSceneManager");UiSceneManager.attributes.add("startScene",{type:"entity"}),UiSceneManager.attributes.add("instructionsScene",{type:"entity"}),UiSceneManager.attributes.add("inGameScene",{type:"entity"}),UiSceneManager.attributes.add("endScene",{type:"entity"}),UiSceneManager.attributes.add("endBGScene",{type:"entity"}),UiSceneManager.attributes.add("endBGElement",{type:"entity"}),UiSceneManager.attributes.add("transitionSpeed",{type:"number"}),UiSceneManager.prototype.initialize=function(){let e=this;this.scenes=[this.startScene,this.instructionsScene,this.endScene,this.inGameScene,this.leaderboardScene],this.currentScene=this.startScene,this.isEndVisible=!0,this.endPanRect=new pc.Vec4(0,0,2.5,4),this.scenes.forEach((function(t){this.currentScene!=t&&e.switchSceneState(t,"off")})),this.handleOpacityAndButtons(this.currentScene,"on"),this.opacityTween=void 0,this.app.on("changeScene",(function(t){e.changeScene(t)}),this)},UiSceneManager.prototype.changeScene=function(e){this.handleOpacityAndButtons(this.currentScene,"off"),this.currentScene!==this.inGameScene||"end"!==e&&"leadGen"!==e?this.currentScene===this.endScene&&"game"===e&&(this.isEndVisible=!1,this.handleOpacityAndButtons(this.endBGScene,"off")):(this.isEndVisible=!0,this.handleOpacityAndButtons(this.endBGScene,"on")),"start"===e&&(this.handleOpacityAndButtons(this.startScene,"on"),this.currentScene=this.startScene),"instructions"===e?(this.handleOpacityAndButtons(this.instructionsScene,"on"),this.currentScene=this.instructionsScene):"game"===e?(this.handleOpacityAndButtons(this.inGameScene,"on"),this.currentScene=this.inGameScene):"end"===e&&(this.handleOpacityAndButtons(this.endScene,"on"),this.currentScene=this.endScene)},UiSceneManager.prototype.handleOpacityAndButtons=function(e,t){let n=e.findComponents("element"),i=this,c={value:n[0].opacity},s=1;"off"===t?(s=0,this.switchButtons(e,"off")):"on"===t&&(n.forEach((function(e){1!=e.mask&&(e.opacity=0)})),e.setPosition(0,0,0)),this.opacityTween=e.tween(c).to({value:s},this.transitionSpeed,pc.QuadraticInOut).delay(0).onUpdate((function(){n.forEach((function(e){1!=e.mask&&(e.opacity=c.value)}))})).onComplete((function(){"off"===t?e.setPosition(-1e3,0,0):i.switchButtons(e,"on")})).start()},UiSceneManager.prototype.switchSceneState=function(e,t){this.switchOpacity(e,t),this.switchButtons(e,t)},UiSceneManager.prototype.switchOpacity=function(e,t){let n=1;"off"===t&&(n=0),e.findComponents("button").forEach((function(e){1!=e.mask&&(e.opacity=n)}))},UiSceneManager.prototype.switchButtons=function(e,t){let n=!0;"off"===t&&(n=!1),e.findComponents("button").forEach((function(e){e.active=n}))},UiSceneManager.prototype.update=function(e){this.isEndVisible&&(this.endPanRect.x-=5e-4,this.endPanRect.y+=5e-4,this.endBGElement.element.rect=this.endPanRect)};var InputManager=pc.createScript("inputManager");InputManager.attributes.add("startBtn",{type:"entity"}),InputManager.attributes.add("instructionsBtn",{type:"entity"}),InputManager.attributes.add("exitInstructionsBtn",{type:"entity"}),InputManager.attributes.add("resetBtn0",{type:"entity"}),InputManager.attributes.add("resetBtn1",{type:"entity"}),InputManager.attributes.add("externalPrizeBtn0",{type:"entity"}),InputManager.attributes.add("externalPrizeBtn1",{type:"entity"}),InputManager.prototype.initialize=function(){let t=this;this.startBtn.button.on("click",(function(){t.app.fire("startButtonPress")}),this),this.instructionsBtn.button.on("click",(function(){t.app.fire("instructionsButtonPress")}),this),this.exitInstructionsBtn.button.on("click",(function(){t.app.fire("exitInstructionsButtonPress")}),this),this.resetBtn0.button.on("click",(function(){t.app.fire("resetButtonPress")}),this),this.resetBtn1.button.on("click",(function(){t.app.fire("resetButtonPress")}),this),this.externalPrizeBtn0.button.on("click",(function(){t.app.fire("prizeButtonPress")}),this),this.externalPrizeBtn1.button.on("click",(function(){t.app.fire("prizeButtonPress")}),this)};var FinishGameTransitionManager=pc.createScript("finishGameTransitionManager");FinishGameTransitionManager.attributes.add("timesUp",{type:"entity"}),FinishGameTransitionManager.prototype.initialize=function(){this.opacityObject={value:0},this.opacityTween=void 0,this.app.on("startFinishGameTransition",this.startFinishGameTransition,this),this.app.on("resetOverlays",this.resetFinishGameTransition,this)},FinishGameTransitionManager.prototype.startFinishGameTransition=function(t){let i=this;for(let t=0;t<this.entity.children.length;t++)this.entity.children[t].element.opacity=0,this.entity.children[t].enabled=!0;this.opacityTween=this.entity.tween(this.opacityObject).to({value:1},.15,pc.QuadraticInOut).delay(0).onUpdate((function(){for(let t=0;t<i.entity.children.length;t++)i.entity.children[t].element.opacity=i.opacityObject.value})).onComplete((function(){i.app.tween({}).to({},1.5,pc.Linear).delay(0).onComplete((function(){i.app.fire("endFinishGameTransition")}),this).start()}),this).start()},FinishGameTransitionManager.prototype.resetFinishGameTransition=function(t){for(let t=0;t<this.entity.children.length;t++)this.entity.children[t].element.opacity=0,this.entity.children[t].enabled=!0;this.opacityObject={value:0}};var ExternalPrize=pc.createScript("externalPrize");ExternalPrize.attributes.add("shouldServePrize",{type:"boolean",default:!0}),ExternalPrize.attributes.add("shouldDropDown",{type:"boolean",default:!0}),ExternalPrize.attributes.add("externalPrizeURL",{type:"string"}),ExternalPrize.attributes.add("prizeThreshold",{type:"number",default:10}),ExternalPrize.attributes.add("claimPrizeGrp",{type:"entity"}),ExternalPrize.attributes.add("noClaimPrizeGrp",{type:"entity"}),ExternalPrize.attributes.add("prizeOverlay",{type:"entity"}),ExternalPrize.prototype.initialize=function(){let e=this;this.onScreenOverlayPos=this.prizeOverlay.getLocalPosition().clone(),this.offScreenOverlayPos=new pc.Vec3(this.onScreenOverlayPos.x,this.onScreenOverlayPos.y+600,0),this.prizeOverlay.setLocalPosition(this.offScreenOverlayPos),this.claimPrizeGrp.enabled=!1,this.noClaimPrizeGrp.enabled=!0,this.hasPrizePopped=!1,this.willDropDown=this.shouldDropDown,this.shouldServePrize?(this.app.on("preventDropDownCoupon",(function(){this.willDropDown=!1}),this),this.app.on("serveExternalPrize",(function(){}),this),this.app.on("checkPrizeNotification",(function(t){t>=e.prizeThreshold&&!e.hasPrizePopped&&(e.hasPrizePopped=!0,e.willDropDown&&e.prizeNotifAnimation(),e.enableEndgamePrizeButton())}),this),this.app.on("resetPrizeNotification",(function(){e.hasPrizePopped=!1}),this)):this.entity.script.destroy("externalPrize")},ExternalPrize.prototype.enableEndgamePrizeButton=function(){this.claimPrizeGrp.enabled=!0,this.noClaimPrizeGrp.enabled=!1},ExternalPrize.prototype.prizeNotifAnimation=function(){var e=this;this.tween=this.prizeOverlay.tween(this.prizeOverlay.getLocalPosition()).to(this.onScreenOverlayPos,.8,pc.BackOut).delay(.5).loop(!1).yoyo(!1).onComplete((function(){e.tween=e.prizeOverlay.tween(e.prizeOverlay.getLocalPosition()).to(e.offScreenOverlayPos,.3,pc.QuadraticIn).delay(3).loop(!1).yoyo(!1).start()}),this).start()};var CountdownManager=pc.createScript("countdownManager");CountdownManager.attributes.add("one",{type:"entity"}),CountdownManager.attributes.add("two",{type:"entity"}),CountdownManager.attributes.add("three",{type:"entity"}),CountdownManager.attributes.add("go",{type:"entity"}),CountdownManager.prototype.initialize=function(){this.opacityObject={value:0},this.opacityTween=void 0,this.app.on("startCountdown",this.startCountdown,this),this.app.on("resetOverlays",this.resetCountdown,this)},CountdownManager.prototype.startCountdown=function(){let t=this;for(let t=0;t<this.entity.children.length;t++)this.entity.children[t].element.opacity=1,this.entity.children[t].enabled=!1;this.three.enabled=!0,this.three.element.opacity=0,this.opacityTween=this.entity.tween(this.opacityObject).to({value:1},.3,pc.QuadraticInOut).onUpdate((function(){t.three.element.opacity=t.opacityObject.value})).onComplete((function(){t.app.tween({}).to({},.9,pc.Linear).onComplete((function(){t.three.enabled=!1,t.two.enabled=!0,t.app.tween({}).to({},1.2,pc.Linear).onComplete((function(){t.two.enabled=!1,t.one.enabled=!0,t.app.tween({}).to({},1.2,pc.Linear).onComplete((function(){t.one.enabled=!1,t.app.fire("endCountdown"),t.go.enabled=!0,t.opacityTween=t.entity.tween(t.opacityObject).to({value:0},.3,pc.QuadraticInOut).delay(.5).onUpdate((function(){t.go.element.opacity=t.opacityObject.value})).start()}),this).start()}),this).start()}),this).start()}),this).start()},CountdownManager.prototype.resetCountdown=function(){for(let t=0;t<this.entity.children.length;t++)this.entity.children[t].element.opacity=1,this.entity.children[t].enabled=!1};var AppManager=pc.createScript("appManager");AppManager.attributes.add("inGameScoreTextEntity",{type:"entity"}),AppManager.attributes.add("endScreenScoreEntity",{type:"entity"}),AppManager.attributes.add("endScreenHiscoreEntity",{type:"entity"}),AppManager.prototype.initialize=function(){this.score=0,this.hiscore=0,this.gameStarted=!0,this.app.on("startButtonPress",this.startGameFromStartButton,this),this.app.on("instructionsButtonPress",this.viewInstructions,this),this.app.on("exitInstructionsButtonPress",this.leaveInstructions,this),this.app.on("endCountdown",this.endCountdown,this),this.app.on("stopGame",this.stopGame,this),this.app.on("endFinishGameTransition",this.endFinishGameTransition,this),this.app.on("resetButtonPress",this.startCountdown,this),this.app.on("prizeButtonPress",this.tryToClaimPrize,this),this.app.on("addPoints",this.addPoints,this)},AppManager.prototype.addPoints=function(t){this.score+=t,this.app.fire("checkPrizeNotification",this.score)},AppManager.prototype.setPoints=function(t){this.score=t,this.app.fire("checkPrizeNotification",this.score)},AppManager.prototype.updateScoreText=function(t){let e=this.score.toString();t.element.text=e},AppManager.prototype.updateScoreText_formatted=function(t){let e=this.score.toString();e<10?e="0000"+e:e<100?e="000"+e:e<1e3?e="00"+e:e<1e4&&(e="0"+e),t.element.text=e},AppManager.prototype.startGameFromStartButton=function(){this.app.fire("startGameIntro"),this.startCountdown()},AppManager.prototype.tryToClaimPrize=function(){this.app.fire("serveExternalPrize")},AppManager.prototype.startCountdown=function(){this.setPoints(0),this.app.fire("setBallOffScreen"),this.app.fire("resetGameData"),this.app.fire("resetCamera"),this.app.fire("disableGameplay"),this.app.fire("resetOverlays"),this.app.fire("startCountdown"),this.app.fire("changeScene","game")},AppManager.prototype.endCountdown=function(){this.startGame()},AppManager.prototype.startFinishGameTransition=function(){this.gameStarted=!1,this.app.fire("startFinishGameTransition")},AppManager.prototype.endFinishGameTransition=function(){this.score>this.hiscore&&(this.hiscore=this.score,this.updateScoreText_formatted(this.endScreenHiscoreEntity)),this.updateScoreText_formatted(this.endScreenScoreEntity),this.app.fire("changeScene","end")},AppManager.prototype.viewInstructions=function(){this.app.fire("changeScene","instructions")},AppManager.prototype.leaveInstructions=function(){this.app.fire("changeScene","start")},AppManager.prototype.startGame=function(){this.app.fire("enableGameplay")},AppManager.prototype.stopGame=function(){this.app.fire("startFinishGameTransition"),this.app.fire("disableGameplay")};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("playcanvas")):"function"==typeof define&&define.amd?define(["playcanvas"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pc)}(this,(function(t){"use strict";const Linear=function(t){return t},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};var e=Object.freeze({__proto__:null,BackIn:function(t){const e=1.70158;return t*t*((e+1)*t-e)},BackInOut:function(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},BackOut:function(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},BounceIn:BounceIn,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},BounceOut:BounceOut,CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CubicIn:function(t){return t*t*t},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},CubicOut:function(t){return--t*t*t+1},ElasticIn:function(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},ElasticInOut:function(t){const e=.4;let i,s=.1;return 0===t?0:1===t?1:(!s||s<1?(s=1,i=.1):i=e*Math.asin(1/s)/(2*Math.PI),(t*=2)<1?s*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)*-.5:s*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/e)*.5+1)},ElasticOut:function(t){let e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},Linear:Linear,QuadraticIn:function(t){return t*t},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},QuadraticOut:function(t){return t*(2-t)},QuarticIn:function(t){return t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuarticOut:function(t){return 1- --t*t*t*t},QuinticIn:function(t){return t*t*t*t*t},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},QuinticOut:function(t){return--t*t*t*t*t+1},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)}});class TweenManager{_tweens=[];_add=[];add(t){return this._add.push(t),t}update(t){let e=0,i=this._tweens.length;for(;e<i;)this._tweens[e].update(t)?e++:(this._tweens.splice(e,1),i--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}}class Tween extends t.EventHandler{constructor(e,i,s){super(),this.manager=i,s&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=e,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new t.Quat,this._toQuat=new t.Quat,this._quat=new t.Quat,this.easing=Linear,this._sv={},this._ev={}}_parseProperties(e){let i;return e instanceof t.Vec2?i={x:e.x,y:e.y}:e instanceof t.Vec3?i={x:e.x,y:e.y,z:e.z}:e instanceof t.Vec4||e instanceof t.Quat?i={x:e.x,y:e.y,z:e.z,w:e.w}:e instanceof t.Color?(i={r:e.r,g:e.g,b:e.b},void 0!==e.a&&(i.a=e.a)):i=e,i}to(t,e,i,s,n,r){return this._properties=this._parseProperties(t),this.duration=e,i&&(this.easing=i),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this}from(t,e,i,s,n,r){return this._properties=this._parseProperties(t),this.duration=e,i&&(this.easing=i),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this}rotate(t,e,i,s,n,r){return this._properties=this._parseProperties(t),this.duration=e,i&&(this.easing=i),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this}start(){let t,e,i,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),e=void 0!==this._properties.x?this._properties.x:this.target.x,i=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(e,i,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(e=void 0!==this._properties.x?this._properties.x:this.target.x,i=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(e,i,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(e,i,s)))}return this._currentDelay=this._delay,this.manager.add(this),this}pause(){this.playing=!1}resume(){this.playing=!0}stop(){this.playing=!1,this.stopped=!0}delay(t){return this._delay=t,this.pending=!0,this}repeat(t,e){return this._count=0,this._numRepeats=t,this._repeatDelay=e||0,this}loop(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this}yoyo(t){return this._yoyo=t,this}reverse(){return this._reverse=!this._reverse,this}chain(){let t=arguments.length;for(;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this}onUpdate(t){return this.on("update",t),this}onComplete(t){return this.on("complete",t),this}onLoop(t){return this.on("loop",t),this}update(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}let e=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(e=this.duration-this.time,this.time=0):(e=this.time-this.duration,this.time=this.duration));const i=0===this.duration?1:this.time/this.duration,s=this.easing(i);let n,r;for(const t in this._properties)this._properties.hasOwnProperty(t)&&(n=this._sv[t],r=this._ev[t],this.target[t]=n+(r-n)*s);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,s),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){const t=this._repeat(e);return t?this.fire("loop"):(this.fire("complete",e),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),t}return!0}_repeat(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(const t in this._properties){const e=this._sv[t];this._sv[t]=this._ev[t],this._ev[t]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}}const i=new Map,getTweenManager=e=>{if(!(e&&e instanceof t.AppBase))throw new Error("`getTweenManager` expects an instance of `AppBase`");if(!i.has(e)){const t=new TweenManager;i.set(e,t),e.on("update",(e=>{t.update(e)})),e.on("destroy",(()=>i.delete(e)))}return i.get(e)};if(!globalThis.pc)throw new Error("There is no global `pc` playcanvas object.");Object.assign(globalThis.pc,e),(({AppBase:t,Entity:e})=>{if(!t)throw new Error("The param `addExtensions` must contain the `AppBase` class. `addExtensions({ AppBase })`");if(!e)throw new Error("The param `addExtensions` must contain the `Entity` class. `addExtensions({ Entity })`");t.prototype.tween=function(t){const e=getTweenManager(this);return new Tween(t,e)},e.prototype.tween=function(t,e){return((t,e,i)=>{const s=getTweenManager(t._app),n=new Tween(e,s);return n.entity=t,t.once("destroy",n.stop,n),i&&i.element&&(n.element=i.element),n})(this,t,e)}})(globalThis.pc),globalThis.pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=getTweenManager(this)}}));